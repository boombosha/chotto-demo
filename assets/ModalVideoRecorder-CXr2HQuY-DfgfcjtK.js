import{L as N,e as z,r as u,c as J,f as K,o as m,a as b,b as l,w as V,g as j,n as y,h as k,t as P,F as Q,i as W,u as g}from"./index-CeyIPbL_.js";const X={class:"video-recorder__header"},q={class:"video-recorder__controls"},A={class:"video-recorder__recording-container"},G={class:"video-recorder__recording-time"},H=z({__name:"ModalVideoRecorder",emits:["change","submit","close"],setup(Y,{emit:B}){const F=u(),o=u(0),s=u(0),c=u(0),d=u(0),E=J(()=>{let a=d.value<10?"0"+d.value:d.value,e=c.value<10?"0"+c.value:c.value,r=s.value<10?"0"+s.value:s.value,f=o.value<10?"00"+o.value:o.value<100?"0"+o.value:o.value;return v.value?a+":"+e+":"+r+":"+f:" "}),_=u(),w=u(),v=u(!1),n=u(),p=u(),h=u([]),t=u(),C=u(),i=u("camera"),O=()=>{i.value=="camera"?(i.value="screen",T()):i.value=="screen"&&(M(),i.value="camera",R())},S=async()=>{!v.value&&p.value instanceof MediaStream&&(n.value=new MediaRecorder(p.value),n.value.start(),n.value.ondataavailable=a=>{h.value.push(a.data)},v.value=!0,F.value=setInterval(()=>{o.value+=10,o.value==1e3&&(o.value=0,s.value++,s.value==60&&(s.value=0,c.value++,c.value==60&&(c.value=0,d.value++)))},10))},U=async()=>{L(),M(),t.value&&(t.value=void 0,await R())},x=()=>{n.value&&(n.value.stop(),n.value.onstop=async()=>{C.value=new File(h.value,"videomessage.mp4",{type:"video/*"});const a=URL.createObjectURL(C.value);t.value=a,W(()=>{w.value&&(w.value.src=a)})}),L(),M()};function M(){var a;let e=(a=p.value)==null?void 0:a.getTracks();e==null||e.forEach(r=>r.stop())}const L=()=>{clearInterval(F.value),o.value=0,s.value=0,c.value=0,d.value=0,v.value=!1,n.value=void 0,h.value=[]},D=B,I=()=>{D("change",{videoFile:C.value}),D("submit")},R=async()=>{await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(a=>{const e=g(_.value);p.value=a,e.srcObject=a,e.addEventListener("loadedmetadata",()=>{var r;(r=g(_.value))==null||r.play()}),e.muted=!0})},T=async()=>{const a={video:{cursor:"always"},audio:!1};await navigator.mediaDevices.getDisplayMedia(a).then(e=>{const r=g(_.value);p.value=e,r.srcObject=e,r.addEventListener("loadedmetadata",()=>{var f;(f=g(_.value))==null||f.play()}),r.muted=!0})};return K(async()=>{await R()}),(a,e)=>(m(),b(Q,null,[l("div",X,[l("button",{class:"video-recorder__button video-recorder__button-close",onClick:e[0]||(e[0]=r=>D("close"))},[...e[1]||(e[1]=[l("span",{class:"pi pi-times"},null,-1)])])]),l("div",null,[V(l("video",{ref_key:"refVideo",ref:_,class:"video-recorder__view-area"},null,512),[[j,!t.value]]),V(l("video",{ref_key:"refRecord",ref:w,class:"video-recorder__view-area",controls:""},null,512),[[j,t.value]]),l("div",q,[l("div",A,[!v.value&&!t.value?(m(),b("button",{key:0,class:"video-recorder__button",onClick:O},[l("span",{class:y({"pi pi-desktop":i.value=="camera","pi pi-camera":i.value=="screen"})},null,2)])):k("",!0),t.value?k("",!0):(m(),b("button",{key:1,class:y(["video-recorder__button",{"video-recorder__recording-button":v.value}]),onClick:S},[l("span",{class:y(["pi",{"pi-circle-fill video-recorder__recording-icon":v.value,"pi-video":!v.value}])},null,2)],2)),!v.value&&t.value?(m(),b("button",{key:2,class:"video-recorder__button",onClick:U},[...e[2]||(e[2]=[l("span",{class:"pi pi-trash"},null,-1)])])):k("",!0),v.value?(m(),b("button",{key:3,class:"video-recorder__button",onClick:x},[...e[3]||(e[3]=[l("div",{class:"video-recorder__stop"},null,-1)])])):k("",!0),l("span",G,P(E.value),1)]),l("button",{class:y(["video-recorder__button",{"video-recorder__button-disabled":!t.value}]),onClick:I},[...e[4]||(e[4]=[l("span",{class:"video-recorder__save-button"}," Прикрепить видео ",-1)])],2)])])],64))}}),$=N(H,[["__scopeId","data-v-1cbcf75c"]]);export{$ as default};
